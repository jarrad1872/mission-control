<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>üéØ Mission Control ‚Äî Bob Dashboard</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Bob Collective Command Center ‚Äî Monitor, manage, and control your AI assistant collective">
    <meta name="theme-color" content="#e94560">
    <meta name="background-color" content="#0f0f1a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MissionCtrl">
    <meta name="application-name" content="Mission Control">
    <meta name="msapplication-TileColor" content="#e94560">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72.png">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-192.png">
    
    <!-- Apple Splash Screens -->
    <link rel="apple-touch-startup-image" href="icons/icon-512.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/pwa.css">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>üéØ Mission Control</h1>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="dataStatus">
                    <span class="status-dot" id="globalStatusDot"></span>
                </div>
                <button class="search-trigger" id="quickSearchTrigger" title="Quick Search (‚åòK)" aria-label="Quick Search">
                    üîç
                </button>
                <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode" aria-label="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
                <button class="btn-refresh" id="refreshBtn" title="Refresh Data">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Pull to Refresh Indicator -->
        <div class="pull-refresh-indicator" id="pullRefreshIndicator">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text">Release to refresh</span>
        </div>

        <!-- Bob Status Summary Row (Compact) -->
        <section class="bob-summary-row" id="bobSummaryRow">
            <div class="bob-summary-chips" id="bobSummaryChips">
                <!-- Chips rendered by bob-status.js -->
                <div class="loading-dots"><span></span><span></span><span></span></div>
            </div>
        </section>

        <!-- Main Content (Scrollable) -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Tab -->
            <section class="tab-content active" id="dashboard-tab">
                <!-- Usage Stats Panel -->
                <section class="collapsible-section" data-section="usage-stats">
                    <div class="section-header collapsible-header">
                        <h2>üìä Usage Stats</h2>
                        <div class="section-header-right">
                            <span class="update-time" id="costUpdateTime">‚Äî</span>
                            <svg class="collapse-chevron" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                            </svg>
                        </div>
                    </div>
                    <div class="collapsible-content" id="costTrackerContent">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <span>Loading cost data...</span>
                        </div>
                    </div>
                </section>

                <!-- Activity Feed Section -->
                <section class="collapsible-section" data-section="activity-feed">
                    <div class="section-header collapsible-header">
                        <h2>Activity Feed</h2>
                        <div class="section-header-right">
                            <div class="filters inline-filters">
                                <select id="activityType" class="filter-select">
                                    <option value="all">All</option>
                                    <option value="commit">Commits</option>
                                    <option value="task">Tasks</option>
                                    <option value="event">Events</option>
                                </select>
                            </div>
                            <svg class="collapse-chevron" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                            </svg>
                        </div>
                    </div>
                    <div class="collapsible-content">
                        <div class="activity-list" id="activityList">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <span>Loading activity...</span>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Tasks Tab (Kanban Board) -->
            <section class="tab-content" id="tasks-tab">
                <div class="section-header">
                    <h2>üìã Task Board</h2>
                    <div class="kanban-meta">
                        <span class="kanban-updated">Updated: <span id="kanbanUpdated">‚Äî</span></span>
                    </div>
                </div>
                <div class="kanban-board" id="kanban-board">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading tasks...</span>
                    </div>
                </div>
            </section>

            <!-- Stats/Analytics Tab -->
            <section class="tab-content" id="stats-tab">
                <div class="section-header">
                    <h2>üìä Analytics Dashboard</h2>
                    <div class="filters">
                        <select id="analyticsRange" class="filter-select">
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="30">30 days</option>
                        </select>
                        <button class="btn-refresh" id="refreshAnalytics" title="Refresh Analytics">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="analytics-container" id="analyticsContainer">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading analytics...</span>
                    </div>
                </div>
            </section>

            <!-- Activity/Sessions Tab -->
            <section class="tab-content" id="activity-tab">
                <div class="sessions-panel">
                    <div class="sessions-header">
                        <h2>üì° Active Sessions</h2>
                        <span class="update-time" id="sessionsUpdateTime">‚Äî</span>
                    </div>
                    
                    <div class="sessions-toolbar">
                        <div class="session-filters">
                            <button class="filter-btn active" data-session-filter="all">
                                All <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="main">
                                Main <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="subagent">
                                Sub <span class="filter-count">0</span>
                            </button>
                        </div>
                        <div class="session-sort">
                            <select id="sessionSort" class="filter-select">
                                <option value="recent">Recent</option>
                                <option value="tokens">Tokens</option>
                                <option value="context">Context</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="sessions-list" id="sessionsListContainer">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <span>Loading sessions...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- More: Search Tab -->
            <section class="tab-content" id="search-tab">
                <div class="search-header">
                    <div class="search-box">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search memory, tasks, docs..." autocomplete="off">
                    </div>
                </div>
                <div class="search-filters">
                    <label class="filter-checkbox">
                        <input type="checkbox" value="memory" checked> Memory
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="tasks" checked> Tasks
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="docs" checked> Docs
                    </label>
                </div>
                <div class="search-results" id="searchResults">
                    <div class="search-placeholder">
                        <span class="placeholder-emoji">üîç</span>
                        <p>Start typing to search</p>
                    </div>
                </div>
            </section>

            <!-- More: Voice Tab -->
            <section class="tab-content" id="voice-tab">
                <div class="voice-container">
                    <div class="voice-loading">
                        <div class="spinner"></div>
                        <span>Loading ClawChat...</span>
                    </div>
                    <div class="voice-iframe-wrapper">
                        <!-- Iframe lazy-loaded by voice.js -->
                    </div>
                    <div class="voice-fallback">
                        <a href="https://infrared-lounge-sherman-set.trycloudflare.com" target="_blank" class="voice-fallback-link">
                            Open ClawChat ‚Üí
                        </a>
                    </div>
                </div>
            </section>

            <!-- More: Memory Tab -->
            <section class="tab-content" id="memory-tab">
                <div class="memory-browser">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading knowledge graph...</span>
                    </div>
                </div>
            </section>

            <!-- More: Sessions/Control Tab -->
            <section class="tab-content" id="sessions-tab">
                <div class="section-header">
                    <h2>üéÆ Command Center</h2>
                    <p class="section-subtitle">Send commands and trigger actions</p>
                </div>
                <div id="control-panel">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading control panel...</span>
                    </div>
                </div>
            </section>

            <!-- More: Calendar Tab -->
            <section class="tab-content" id="calendar-tab">
                <div class="section-header">
                    <h2>Weekly Schedule</h2>
                    <div class="calendar-nav">
                        <button class="nav-btn" id="prevWeek">‚Üê</button>
                        <span class="current-week" id="currentWeek">Loading...</span>
                        <button class="nav-btn" id="nextWeek">‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading calendar...</span>
                    </div>
                </div>
            </section>

            <!-- More: CFO Center Tab -->
            <section class="tab-content" id="cfo-tab">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <span>Loading CFO data...</span>
                </div>
            </section>
        </main>

        <!-- Floating Action Button (FAB) -->
        <button class="fab" id="fabButton" aria-label="Quick Actions" title="Quick Actions">
            <span class="fab-icon">‚ö°</span>
        </button>

        <!-- FAB Menu (Bottom Sheet on Mobile) -->
        <div class="fab-menu" id="fabMenu">
            <div class="fab-menu-backdrop"></div>
            <div class="fab-menu-content">
                <div class="fab-menu-header">
                    <h3>Quick Actions</h3>
                    <button class="fab-menu-close" aria-label="Close">√ó</button>
                </div>
                <div class="fab-menu-grid" id="fabMenuGrid">
                    <!-- Actions rendered by quick-actions.js -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="bottomNav">
            <button class="nav-item active" data-tab="dashboard" title="Dashboard">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">Home</span>
            </button>
            <button class="nav-item" data-tab="tasks" title="Tasks">
                <span class="nav-icon">‚úÖ</span>
                <span class="nav-label">Tasks</span>
            </button>
            <button class="nav-item" data-tab="cfo" title="CFO Center">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">CFO</span>
            </button>
            <button class="nav-item" data-tab="activity" title="Sessions & Activity">
                <span class="nav-icon">üì°</span>
                <span class="nav-label">Activity</span>
            </button>
            <button class="nav-item" data-tab="more" title="More Options">
                <span class="nav-icon">‚ãØ</span>
                <span class="nav-label">More</span>
            </button>
        </nav>

        <!-- More Menu Drawer -->
        <div class="more-drawer" id="moreDrawer">
            <div class="more-drawer-backdrop"></div>
            <div class="more-drawer-content">
                <div class="more-drawer-header">
                    <h3>More</h3>
                    <button class="more-drawer-close" aria-label="Close">√ó</button>
                </div>
                <div class="more-drawer-items">
                    <button class="more-item" data-tab="search">
                        <span class="more-icon">üîç</span>
                        <span class="more-label">Search</span>
                    </button>
                    <button class="more-item" data-tab="voice">
                        <span class="more-icon">üéôÔ∏è</span>
                        <span class="more-label">Voice</span>
                    </button>
                    <button class="more-item" data-tab="memory">
                        <span class="more-icon">üß†</span>
                        <span class="more-label">Memory</span>
                    </button>
                    <button class="more-item" data-tab="stats">
                        <span class="more-icon">üìä</span>
                        <span class="more-label">Stats</span>
                    </button>
                    <button class="more-item" data-tab="sessions">
                        <span class="more-icon">üéÆ</span>
                        <span class="more-label">Control</span>
                    </button>
                    <button class="more-item" data-tab="calendar">
                        <span class="more-icon">üìÖ</span>
                        <span class="more-label">Calendar</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Bob Detail Modal -->
        <div class="modal" id="bobDetailModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content modal-bottom-sheet">
                <div class="modal-header">
                    <h3 id="bobDetailTitle">Bob Details</h3>
                    <button class="close-btn" id="closeBobDetail">√ó</button>
                </div>
                <div class="modal-body" id="bobDetailContent">
                    <!-- Bob details rendered dynamically -->
                </div>
            </div>
        </div>

        <!-- Result Detail Modal -->
        <div class="modal" id="resultModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">File Content</h3>
                    <button class="close-btn" id="closeModal">√ó</button>
                </div>
                <div class="modal-body" id="modalBody">
                    <pre id="modalContent"></pre>
                </div>
            </div>
        </div>

        <!-- Session History Modal -->
        <div class="modal" id="sessionHistoryModal">
            <div class="modal-backdrop" onclick="SessionsModule.closeHistoryModal()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 id="historyModalTitle">Session History</h3>
                    <button class="close-btn" onclick="SessionsModule.closeHistoryModal()">√ó</button>
                </div>
                <div class="modal-body" id="historyModalContent">
                </div>
            </div>
        </div>

        <!-- Task Detail Modal -->
        <div class="modal" id="taskDetailModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="taskDetailTitle">Task Details</h3>
                    <button class="close-btn">√ó</button>
                </div>
                <div class="modal-body" id="taskDetailContent">
                </div>
            </div>
        </div>

        <!-- Event Detail Panel -->
        <div class="event-detail-panel" id="eventDetailPanel">
            <div class="panel-header">
                <h3 id="eventDetailTitle">Select an event</h3>
                <button class="close-btn" id="closeEventPanel">√ó</button>
            </div>
            <div class="panel-content" id="eventDetailContent">
                <p class="placeholder-text">Click on a calendar event to view details.</p>
            </div>
        </div>

        <!-- Quick Search Modal -->
        <div class="quick-search-modal" id="quickSearchModal">
            <div class="quick-search-backdrop"></div>
            <div class="quick-search-content">
                <div class="quick-search-header">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                    </svg>
                    <input type="text" id="quickSearchInput" class="quick-search-input" placeholder="Search tasks, activity, memory..." autocomplete="off">
                    <span class="quick-search-hint">ESC</span>
                </div>
                <div class="quick-search-results" id="quickSearchResults">
                    <div class="quick-search-empty">
                        <span class="quick-search-empty-icon">üîç</span>
                        <p>Start typing to search</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Core Scripts -->
    <script src="js/data.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/bob-status.js"></script>
    <script src="js/costs.js"></script>
    <script src="js/activity.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/search.js"></script>
    <script src="js/voice.js"></script>
    <script src="js/quick-actions.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/sessions.js"></script>
    <script src="js/memory-browser.js"></script>
    <script src="js/kanban.js"></script>
    <script src="js/control.js"></script>
    <script src="js/cfo.js"></script>
    <script src="js/pull-refresh.js"></script>
    <script src="js/main.js"></script>
    
    <!-- PWA Support -->
    <script src="js/pwa.js"></script>
</body>
</html>
