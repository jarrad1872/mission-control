<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>üéØ Mission Control ‚Äî Bob Dashboard</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Bob Collective Command Center ‚Äî Monitor, manage, and control your AI assistant collective">
    <meta name="theme-color" content="#e94560">
    <meta name="background-color" content="#0f0f1a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MissionCtrl">
    <meta name="application-name" content="Mission Control">
    <meta name="msapplication-TileColor" content="#e94560">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72.png">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-192.png">
    
    <!-- Apple Splash Screens -->
    <link rel="apple-touch-startup-image" href="icons/icon-512.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/pwa.css">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>üéØ Mission Control</h1>
                <span class="subtitle">Bob Collective Dashboard</span>
            </div>
            <div class="header-right">
                <span class="status-indicator" id="dataStatus">
                    <span class="status-dot"></span>
                    <span id="statusText">Loading...</span>
                </span>
                <button class="btn-refresh" id="refreshBtn" title="Refresh Data">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Navigation Tabs (wrapper for scroll indicators) -->
        <div class="nav-tabs-wrapper" id="navTabsWrapper">
            <nav class="nav-tabs" id="navTabs">
                <button class="tab-btn active" data-tab="activity">
                    <span class="tab-icon">üìã</span>
                    <span class="tab-label">Activity</span>
                </button>
                <button class="tab-btn" data-tab="tasks">
                    <span class="tab-icon">‚úÖ</span>
                    <span class="tab-label">Tasks</span>
                </button>
                <button class="tab-btn" data-tab="analytics">
                    <span class="tab-icon">üìä</span>
                    <span class="tab-label">Stats</span>
                </button>
                <button class="tab-btn" data-tab="calendar">
                    <span class="tab-icon">üìÖ</span>
                    <span class="tab-label">Calendar</span>
                </button>
                <button class="tab-btn" data-tab="search">
                    <span class="tab-icon">üîç</span>
                    <span class="tab-label">Search</span>
                </button>
                <button class="tab-btn" data-tab="voice">
                    <span class="tab-icon">üéôÔ∏è</span>
                    <span class="tab-label">Voice</span>
                </button>
                <button class="tab-btn" data-tab="sessions">
                    <span class="tab-icon">üì°</span>
                    <span class="tab-label">Sessions</span>
                </button>
                <button class="tab-btn" data-tab="memory">
                    <span class="tab-icon">üß†</span>
                    <span class="tab-label">Memory</span>
                </button>
                <button class="tab-btn" data-tab="control">
                    <span class="tab-icon">üéÆ</span>
                    <span class="tab-label">Control</span>
                </button>
            </nav>
        </div>

        <!-- Bob Status Panel -->
        <section class="bob-status-panel">
            <div class="bob-status-header" id="bobStatusHeader">
                <h2>üë• Bob Collective Status</h2>
                <button class="collapse-toggle" id="bobStatusToggle" title="Collapse/Expand" aria-label="Toggle Bob Status Panel">
                    <svg class="chevron" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    </svg>
                </button>
            </div>
            <div class="bob-status-content">
                <div class="bob-status-meta">
                    <div class="status-summary" id="bobStatusSummary">
                        <span class="status-count"><span class="dot active"></span> <span id="activeCount">0</span> active</span>
                        <span class="status-count"><span class="dot idle"></span> <span id="idleCount">0</span> idle</span>
                        <span class="status-count"><span class="dot error"></span> <span id="errorCount">0</span> error</span>
                    </div>
                    <span>Updated: <span id="bobStatusUpdated">‚Äî</span></span>
                </div>
            </div>
            <div class="bob-status-grid" id="bobStatusGrid">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <span>Loading Bob status...</span>
                </div>
            </div>
        </section>

        <!-- Quick Actions Panel -->
        <section class="quick-actions-section">
            <div id="quick-actions-panel">
                <!-- Rendered by quick-actions.js -->
            </div>
        </section>

        <!-- Usage Stats Panel -->
        <section class="cost-tracker-panel" id="costTrackerPanel">
            <div class="cost-tracker-header">
                <h2>üìä Usage Stats</h2>
                <span class="update-time" id="costUpdateTime">‚Äî</span>
            </div>
            <div id="costTrackerContent">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <span>Loading cost data...</span>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Activity Feed Tab -->
            <section class="tab-content active" id="activity-tab">
                <div class="section-header">
                    <h2>Activity Feed</h2>
                    <div class="filters">
                        <select id="activityType" class="filter-select">
                            <option value="all">All Types</option>
                            <option value="commit">Git Commits</option>
                            <option value="task">Task Completions</option>
                            <option value="event">Daily Events</option>
                            <option value="arena">Arena Sessions</option>
                        </select>
                        <select id="dateRange" class="filter-select">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                </div>
                <div class="activity-list" id="activityList">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading activity...</span>
                    </div>
                </div>
            </section>

            <!-- Tasks Tab (Kanban Board) -->
            <section class="tab-content" id="tasks-tab">
                <div class="section-header">
                    <h2>üìã Task Board</h2>
                    <div class="kanban-meta">
                        <span class="kanban-updated">Updated: <span id="kanbanUpdated">‚Äî</span></span>
                    </div>
                </div>
                <div class="kanban-board" id="kanban-board">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading tasks...</span>
                    </div>
                </div>
            </section>

            <!-- Analytics Tab -->
            <section class="tab-content" id="analytics-tab">
                <div class="section-header">
                    <h2>üìä Analytics Dashboard</h2>
                    <div class="filters">
                        <select id="analyticsRange" class="filter-select">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                        </select>
                        <button class="btn-refresh" id="refreshAnalytics" title="Refresh Analytics">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="analytics-container" id="analyticsContainer">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading analytics...</span>
                    </div>
                </div>
            </section>

            <!-- Calendar Tab -->
            <section class="tab-content" id="calendar-tab">
                <div class="section-header">
                    <h2>Weekly Schedule</h2>
                    <div class="calendar-nav">
                        <button class="nav-btn" id="prevWeek">‚Üê Prev</button>
                        <span class="current-week" id="currentWeek">Loading...</span>
                        <button class="nav-btn" id="nextWeek">Next ‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading calendar...</span>
                    </div>
                </div>
                <div class="event-detail-panel" id="eventDetailPanel">
                    <div class="panel-header">
                        <h3 id="eventDetailTitle">Select an event</h3>
                        <button class="close-btn" id="closeEventPanel">√ó</button>
                    </div>
                    <div class="panel-content" id="eventDetailContent">
                        <p class="placeholder-text">Click on a calendar event to view details.</p>
                    </div>
                </div>
            </section>

            <!-- Search Tab -->
            <section class="tab-content" id="search-tab">
                <div class="search-header">
                    <div class="search-box">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search memory, tasks, documents..." autocomplete="off">
                        <kbd class="search-hint">‚åòK</kbd>
                    </div>
                </div>
                <div class="search-filters">
                    <label class="filter-checkbox">
                        <input type="checkbox" value="memory" checked> Memory
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="tasks" checked> Tasks
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="docs" checked> Docs
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" value="root" checked> Root Files
                    </label>
                </div>
                <div class="search-results" id="searchResults">
                    <div class="search-placeholder">
                        <span class="placeholder-emoji">üîç</span>
                        <p>Start typing to search across all files</p>
                        <p class="placeholder-hint">Searches memory/, tasks/, docs/, and root markdown files</p>
                    </div>
                </div>
            </section>

            <!-- Voice Tab (ClawChat) -->
            <section class="tab-content" id="voice-tab">
                <div class="voice-container">
                    <div class="voice-loading">
                        <div class="spinner"></div>
                        <span>Loading ClawChat voice interface...</span>
                    </div>
                    <div class="voice-iframe-wrapper">
                        <!-- Iframe lazy-loaded by voice.js -->
                    </div>
                    <div class="voice-fallback">
                        <p>Can't load iframe?</p>
                        <a href="https://infrared-lounge-sherman-set.trycloudflare.com" target="_blank" class="voice-fallback-link">
                            Open ClawChat in new tab ‚Üí
                        </a>
                    </div>
                </div>
            </section>

            <!-- Sessions Tab -->
            <section class="tab-content" id="sessions-tab">
                <div class="sessions-panel">
                    <div class="sessions-header">
                        <h2>üì° Active Sessions</h2>
                        <span class="update-time" id="sessionsUpdateTime">‚Äî</span>
                    </div>
                    
                    <div class="sessions-toolbar">
                        <div class="session-filters">
                            <button class="filter-btn active" data-session-filter="all">
                                All <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="main">
                                üéØ Main <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="subagent">
                                ü§ñ Sub-Bobs <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="cron">
                                ‚è∞ Cron <span class="filter-count">0</span>
                            </button>
                            <button class="filter-btn" data-session-filter="group">
                                üë• Groups <span class="filter-count">0</span>
                            </button>
                        </div>
                        <div class="session-sort">
                            <label for="sessionSort">Sort by:</label>
                            <select id="sessionSort" class="filter-select">
                                <option value="recent">Most Recent</option>
                                <option value="tokens">Token Usage</option>
                                <option value="context">Context %</option>
                                <option value="name">Name</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="sessions-list" id="sessionsListContainer">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <span>Loading sessions...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Memory Tab (Knowledge Graph Browser) -->
            <section class="tab-content" id="memory-tab">
                <div class="memory-browser">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading knowledge graph...</span>
                    </div>
                </div>
            </section>

            <!-- Control Tab (Two-Way Control Panel) -->
            <section class="tab-content" id="control-tab">
                <div class="section-header">
                    <h2>üéÆ Command Center</h2>
                    <p class="section-subtitle">Send commands, create tasks, and trigger actions via the Gateway API</p>
                </div>
                <div id="control-panel">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <span>Loading control panel...</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <span>Last updated: <span id="lastUpdated">‚Äî</span></span>
            <span class="separator">|</span>
            <span>Data generated by <code>build.sh</code></span>
        </footer>
    </div>

    <!-- Result Detail Modal -->
    <div class="modal" id="resultModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">File Content</h3>
                <button class="close-btn" id="closeModal">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <pre id="modalContent"></pre>
            </div>
        </div>
    </div>

    <!-- Session History Modal -->
    <div class="modal" id="sessionHistoryModal">
        <div class="modal-backdrop" onclick="SessionsModule.closeHistoryModal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="historyModalTitle">Session History</h3>
                <button class="close-btn" onclick="SessionsModule.closeHistoryModal()">√ó</button>
            </div>
            <div class="modal-body" id="historyModalContent">
                <!-- History content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskDetailTitle">Task Details</h3>
                <button class="close-btn">√ó</button>
            </div>
            <div class="modal-body" id="taskDetailContent">
                <!-- Task details loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Core Scripts -->
    <script src="js/data.js"></script>
    <script src="js/bob-status.js"></script>
    <script src="js/costs.js"></script>
    <script src="js/activity.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/search.js"></script>
    <script src="js/voice.js"></script>
    <script src="js/quick-actions.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/sessions.js"></script>
    <script src="js/memory-browser.js"></script>
    <script src="js/kanban.js"></script>
    <script src="js/control.js"></script>
    <script src="js/main.js"></script>
    
    <!-- PWA Support -->
    <script src="js/pwa.js"></script>
</body>
</html>
